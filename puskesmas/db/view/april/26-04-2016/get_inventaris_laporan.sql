CREATE  VIEW `satuan_opname` AS select `inv_inventaris_habispakai_opname_item`.`id_inv_inventaris_habispakai_opname` AS `id_inv_inventaris_habispakai_opname`,`inv_inventaris_habispakai_opname_item`.`id_mst_inv_barang_habispakai` AS `id_mst_inv_barang_habispakai`,`inv_inventaris_habispakai_opname_item`.`batch` AS `batch`,`inv_inventaris_habispakai_opname_item`.`jml_awal` AS `jml_awal`,`inv_inventaris_habispakai_opname_item`.`jml_akhir` AS `jml_akhir`,`inv_inventaris_habispakai_opname_item`.`harga` AS `harga`,`mst_inv_barang_habispakai`.`uraian` AS `uraian`,`mst_inv_barang_habispakai`.`pilihan_satuan` AS `pilihan_satuan`,`mst_inv_barang_habispakai`.`merek_tipe` AS `merek_tipe`,`inv_inventaris_habispakai_opname`.`tgl_opname` AS `tgl_opname`,`inv_inventaris_habispakai_opname`.`nomor_opname` AS `nomor_opname`,`inv_inventaris_habispakai_opname`.`code_cl_phc` AS `code_cl_phc`,`inv_inventaris_habispakai_opname`.`catatan` AS `catatan`,`inv_inventaris_habispakai_opname`.`jenis_bhp` AS `jenis_bhp`,`inv_inventaris_habispakai_opname`.`petugas_nama` AS `petugas_nama`,sum(`inv_inventaris_habispakai_opname_item`.`jml_akhir`) AS `sumjml_akhir`,sum(`inv_inventaris_habispakai_opname_item`.`jml_awal`) AS `sumjml_awal`,(select sum((`b`.`jml_akhir` - `b`.`jml_awal`)) from (`inv_inventaris_habispakai_opname_item` `b` join `inv_inventaris_habispakai_opname` `a` on((`a`.`id_inv_inventaris_habispakai_opname` = `b`.`id_inv_inventaris_habispakai_opname`))) where ((`b`.`batch` = `inv_inventaris_habispakai_opname_item`.`batch`) and (`b`.`id_mst_inv_barang_habispakai` = `inv_inventaris_habispakai_opname_item`.`id_mst_inv_barang_habispakai`) and (`a`.`tipe` <> 'retur') and (`a`.`tipe` <> 'terimarusak'))) AS `sumselisih`,ifnull((select `a`.`jml_akhir` from (`inv_inventaris_habispakai_opname_item` `a` join `inv_inventaris_habispakai_opname` `b` on((`a`.`id_inv_inventaris_habispakai_opname` = `b`.`id_inv_inventaris_habispakai_opname`))) where ((`a`.`batch` = `inv_inventaris_habispakai_opname_item`.`batch`) and (`a`.`id_mst_inv_barang_habispakai` = `inv_inventaris_habispakai_opname_item`.`id_mst_inv_barang_habispakai`) and (month(`b`.`tgl_opname`) < `bulan`()) and (year(`b`.`tgl_opname`) <= `tahun`())) order by `b`.`tgl_opname` desc limit 1),0) AS `totalopname`,ifnull((select sum(`inv_inventaris_habispakai_distribusi_item`.`jml`) from (`inv_inventaris_habispakai_distribusi_item` join `inv_inventaris_habispakai_distribusi` on((`inv_inventaris_habispakai_distribusi`.`id_inv_inventaris_habispakai_distribusi` = `inv_inventaris_habispakai_distribusi_item`.`id_inv_inventaris_habispakai_distribusi`))) where ((`inv_inventaris_habispakai_distribusi_item`.`id_mst_inv_barang_habispakai` = `inv_inventaris_habispakai_opname_item`.`id_mst_inv_barang_habispakai`) and (`inv_inventaris_habispakai_distribusi_item`.`batch` = `inv_inventaris_habispakai_opname_item`.`batch`) and (`inv_inventaris_habispakai_distribusi`.`tgl_distribusi` > ifnull((select `d`.`tgl_opname` from (`inv_inventaris_habispakai_opname_item` `c` join `inv_inventaris_habispakai_opname` `d` on((`c`.`id_inv_inventaris_habispakai_opname` = `d`.`id_inv_inventaris_habispakai_opname`))) where ((`c`.`batch` = `inv_inventaris_habispakai_opname_item`.`batch`) and (`c`.`id_mst_inv_barang_habispakai` = `inv_inventaris_habispakai_opname_item`.`id_mst_inv_barang_habispakai`) and (month(`d`.`tgl_opname`) < `bulan`()) and (year(`d`.`tgl_opname`) <= `tahun`())) order by `d`.`tgl_opname` desc limit 1),'0000-00-00')) and (month(`inv_inventaris_habispakai_distribusi`.`tgl_distribusi`) <= `bulan`()) and (year(`inv_inventaris_habispakai_distribusi`.`tgl_distribusi`) <= `tahun`()))),0) AS `totaldistribusi`,(ifnull((select `a`.`jml_akhir` from (`inv_inventaris_habispakai_opname_item` `a` join `inv_inventaris_habispakai_opname` `b` on((`a`.`id_inv_inventaris_habispakai_opname` = `b`.`id_inv_inventaris_habispakai_opname`))) where ((`a`.`batch` = `inv_inventaris_habispakai_opname_item`.`batch`) and (`a`.`id_mst_inv_barang_habispakai` = `inv_inventaris_habispakai_opname_item`.`id_mst_inv_barang_habispakai`) and (month(`b`.`tgl_opname`) < `bulan`()) and (year(`b`.`tgl_opname`) <= `tahun`())) order by `b`.`tgl_opname` desc limit 1),0) + ifnull((select sum(`inv_inventaris_habispakai_distribusi_item`.`jml`) from (`inv_inventaris_habispakai_distribusi_item` join `inv_inventaris_habispakai_distribusi` on((`inv_inventaris_habispakai_distribusi`.`id_inv_inventaris_habispakai_distribusi` = `inv_inventaris_habispakai_distribusi_item`.`id_inv_inventaris_habispakai_distribusi`))) where ((`inv_inventaris_habispakai_distribusi_item`.`id_mst_inv_barang_habispakai` = `inv_inventaris_habispakai_opname_item`.`id_mst_inv_barang_habispakai`) and (`inv_inventaris_habispakai_distribusi_item`.`batch` = `inv_inventaris_habispakai_opname_item`.`batch`) and (`inv_inventaris_habispakai_distribusi`.`tgl_distribusi` > ifnull((select `d`.`tgl_opname` from (`inv_inventaris_habispakai_opname_item` `c` join `inv_inventaris_habispakai_opname` `d` on((`c`.`id_inv_inventaris_habispakai_opname` = `d`.`id_inv_inventaris_habispakai_opname`))) where ((`c`.`batch` = `inv_inventaris_habispakai_opname_item`.`batch`) and (`c`.`id_mst_inv_barang_habispakai` = `inv_inventaris_habispakai_opname_item`.`id_mst_inv_barang_habispakai`) and (month(`d`.`tgl_opname`) < `bulan`()) and (year(`d`.`tgl_opname`) <= `tahun`())) order by `d`.`tgl_opname` desc limit 1),'0000-00-00')) and (month(`inv_inventaris_habispakai_distribusi`.`tgl_distribusi`) <= `bulan`()) and (year(`inv_inventaris_habispakai_distribusi`.`tgl_distribusi`) <= `tahun`()))),0)) AS `jmlawal_opname` from ((`inv_inventaris_habispakai_opname_item` join `mst_inv_barang_habispakai` on((`mst_inv_barang_habispakai`.`id_mst_inv_barang_habispakai` = `inv_inventaris_habispakai_opname_item`.`id_mst_inv_barang_habispakai`))) join `inv_inventaris_habispakai_opname` on((`inv_inventaris_habispakai_opname`.`id_inv_inventaris_habispakai_opname` = `inv_inventaris_habispakai_opname_item`.`id_inv_inventaris_habispakai_opname`))) group by `inv_inventaris_habispakai_opname_item`.`batch`,`inv_inventaris_habispakai_opname_item`.`id_mst_inv_barang_habispakai` order by `inv_inventaris_habispakai_opname_item`.`id_inv_inventaris_habispakai_opname`;
CREATE  VIEW `get_laporan_inv` AS select `mst_inv_barang`.`uraian` AS `uraian`,if((left(`inv_inventaris_barang`.`id_mst_inv_barang`,2) = '01'),`inv_inventaris_barang_a`.`status_sertifikat_nomor`,if((left(`inv_inventaris_barang`.`id_mst_inv_barang`,2) = '02'),ifnull(`inv_inventaris_barang_b`.`nomor_bpkb`,`inv_inventaris_barang_b`.`no_polisi`),if((left(`inv_inventaris_barang`.`id_mst_inv_barang`,2) = '03'),ifnull(`inv_inventaris_barang_c`.`dokumen_nomor`,`inv_inventaris_barang_c`.`nomor_kode_tanah`),if((left(`inv_inventaris_barang`.`id_mst_inv_barang`,2) = '04'),ifnull(`inv_inventaris_barang_d`.`dokumen_nomor`,`inv_inventaris_barang_d`.`nomor_kode_tanah`),if((left(`inv_inventaris_barang`.`id_mst_inv_barang`,2) = '06'),`inv_inventaris_barang_f`.`dokumen_nomor`,'-'))))) AS `nobukti`,if((left(`inv_inventaris_barang`.`id_mst_inv_barang`,2) = '02'),`bahan_b`.`value`,if((left(`inv_inventaris_barang`.`id_mst_inv_barang`,2) = '03'),`bahan_c`.`value`,if((left(`inv_inventaris_barang`.`id_mst_inv_barang`,2) = '05'),`bahan_e`.`value`,if((left(`inv_inventaris_barang`.`id_mst_inv_barang`,2) = '06'),`bahan_f`.`value`,'-')))) AS `bahan`,if((left(`inv_inventaris_barang`.`id_mst_inv_barang`,2) = '01'),`inv_inventaris_barang_a`.`luas`,if((left(`inv_inventaris_barang`.`id_mst_inv_barang`,2) = '02'),`inv_inventaris_barang_b`.`ukuran_barang`,if((left(`inv_inventaris_barang`.`id_mst_inv_barang`,2) = '03'),`inv_inventaris_barang_c`.`luas_lantai`,if((left(`inv_inventaris_barang`.`id_mst_inv_barang`,2) = '04'),`inv_inventaris_barang_d`.`luas`,if((left(`inv_inventaris_barang`.`id_mst_inv_barang`,2) = '05'),`inv_inventaris_barang_e`.`flora_fauna_ukuran`,if((left(`inv_inventaris_barang`.`id_mst_inv_barang`,2) = '06'),`inv_inventaris_barang_f`.`luas`,'-')))))) AS `ukuran`,if((left(`inv_inventaris_barang`.`id_mst_inv_barang`,2) = '01'),`luas_a`.`value`,if((left(`inv_inventaris_barang`.`id_mst_inv_barang`,2) = '02'),`luas_b`.`value`,if((left(`inv_inventaris_barang`.`id_mst_inv_barang`,2) = '05'),`luas_e`.`value`,'-'))) AS `satuan`,if((left(`inv_inventaris_barang`.`id_mst_inv_barang`,2) = '02'),`inv_inventaris_barang_b`.`merek_type`,'-') AS `merk`,`keadaan`.`value` AS `keadaan`,ifnull(`asal`.`value`,'-') AS `asal`,`inv_inventaris_barang`.`id_inventaris_barang` AS `id_inventaris_barang`,`inv_inventaris_barang`.`register` AS `register`,`inv_inventaris_barang`.`id_mst_inv_barang` AS `id_mst_inv_barang`,`inv_inventaris_barang`.`id_pengadaan` AS `id_pengadaan`,`inv_inventaris_barang`.`pilihan_keadaan_barang` AS `pilihan_keadaan_barang`,`inv_inventaris_barang`.`nama_barang` AS `nama_barang`,`inv_inventaris_barang`.`pilihan_komponen` AS `pilihan_komponen`,`inv_inventaris_barang`.`harga` AS `harga`,`inv_inventaris_barang`.`keterangan_pengadaan` AS `keterangan_pengadaan`,`inv_inventaris_barang`.`pilihan_status_invetaris` AS `pilihan_status_invetaris`,`inv_inventaris_barang`.`tanggal_pembelian` AS `tanggal_pembelian`,`inv_inventaris_barang`.`foto_barang` AS `foto_barang`,`inv_inventaris_barang`.`barang_kembar_proc` AS `barang_kembar_proc`,`inv_inventaris_barang`.`keterangan_inventory` AS `keterangan_inventory`,`inv_inventaris_barang`.`tanggal_pengadaan` AS `tanggal_pengadaan`,`inv_inventaris_barang`.`tanggal_diterima` AS `tanggal_diterima`,`inv_inventaris_barang`.`tanggal_dihapus` AS `tanggal_dihapus`,`inv_inventaris_barang`.`alasan_penghapusan` AS `alasan_penghapusan`,`inv_inventaris_barang`.`pilihan_asal` AS `pilihan_asal`,`inv_inventaris_barang`.`waktu_dibuat` AS `waktu_dibuat`,`inv_inventaris_barang`.`terakhir_diubah` AS `terakhir_diubah`,`inv_inventaris_barang`.`code_cl_phc` AS `code_cl_phc`,count(`inv_inventaris_barang`.`id_inventaris_barang`) AS `jumlah` from ((((((((((((((((`inv_inventaris_barang` left join `mst_inv_barang` on((`inv_inventaris_barang`.`id_mst_inv_barang` = `mst_inv_barang`.`code`))) left join `inv_inventaris_barang_a` on((`inv_inventaris_barang_a`.`id_inventaris_barang` = `inv_inventaris_barang`.`id_inventaris_barang`))) left join `inv_inventaris_barang_b` on((`inv_inventaris_barang_b`.`id_inventaris_barang` = `inv_inventaris_barang`.`id_inventaris_barang`))) left join `inv_inventaris_barang_c` on((`inv_inventaris_barang_c`.`id_inventaris_barang` = `inv_inventaris_barang`.`id_inventaris_barang`))) left join `inv_inventaris_barang_d` on((`inv_inventaris_barang_d`.`id_inventaris_barang` = `inv_inventaris_barang`.`id_inventaris_barang`))) left join `inv_inventaris_barang_e` on((`inv_inventaris_barang_e`.`id_inventaris_barang` = `inv_inventaris_barang`.`id_inventaris_barang`))) left join `inv_inventaris_barang_f` on((`inv_inventaris_barang_f`.`id_inventaris_barang` = `inv_inventaris_barang`.`id_inventaris_barang`))) left join `mst_inv_pilihan` `bahan_b` on(((convert(`inv_inventaris_barang_b`.`pilihan_bahan` using utf8) = `bahan_b`.`code`) and (`bahan_b`.`tipe` = 'bahan')))) left join `mst_inv_pilihan` `bahan_c` on(((convert(`inv_inventaris_barang_c`.`pilihan_kons_beton` using utf8) = `bahan_c`.`code`) and (`bahan_c`.`tipe` = 'kons_beton')))) left join `mst_inv_pilihan` `bahan_e` on(((convert(`inv_inventaris_barang_e`.`pilihan_budaya_bahan` using utf8) = `bahan_e`.`code`) and (`bahan_e`.`tipe` = 'bahan')))) left join `mst_inv_pilihan` `bahan_f` on(((convert(`inv_inventaris_barang_c`.`pilihan_kons_beton` using utf8) = `bahan_f`.`code`) and (`bahan_f`.`tipe` = 'kons_beton')))) left join `mst_inv_pilihan` `luas_a` on(((convert(`inv_inventaris_barang_a`.`pilihan_satuan_barang` using utf8) = `luas_a`.`code`) and (`luas_a`.`tipe` = 'satuan')))) left join `mst_inv_pilihan` `luas_b` on(((convert(`inv_inventaris_barang_b`.`pilihan_satuan` using utf8) = `luas_b`.`code`) and (`luas_b`.`tipe` = 'satuan')))) left join `mst_inv_pilihan` `luas_e` on(((convert(`inv_inventaris_barang_e`.`pilihan_satuan` using utf8) = `luas_e`.`code`) and (`luas_e`.`tipe` = 'satuan')))) left join `mst_inv_pilihan` `keadaan` on(((convert(`inv_inventaris_barang`.`pilihan_keadaan_barang` using utf8) = `keadaan`.`code`) and (`keadaan`.`tipe` = 'keadaan_barang')))) left join `mst_inv_pilihan` `asal` on(((convert(`inv_inventaris_barang`.`pilihan_asal` using utf8) = `asal`.`code`) and (`asal`.`tipe` = 'asal_usul')))) group by `inv_inventaris_barang`.`barang_kembar_proc`;
CREATE  VIEW `bhp_retur` AS select ifnull((sum(`inv_inventaris_habispakai_pembelian_item`.`jml_rusak`) - (ifnull((select sum((`b`.`jml_awal` - `b`.`jml_akhir`)) from (`inv_inventaris_habispakai_opname` `a` join `inv_inventaris_habispakai_opname_item` `b` on((`a`.`id_inv_inventaris_habispakai_opname` = `b`.`id_inv_inventaris_habispakai_opname`))) where ((`b`.`batch` = `inv_inventaris_habispakai_pembelian_item`.`batch`) and (`b`.`id_mst_inv_barang_habispakai` = `inv_inventaris_habispakai_pembelian_item`.`id_mst_inv_barang_habispakai`) and (`a`.`tipe` = 'retur'))),0) + ifnull((select sum((`b`.`jml_awal` - `b`.`jml_akhir`)) from (`inv_inventaris_habispakai_opname` `a` join `inv_inventaris_habispakai_opname_item` `b` on((`a`.`id_inv_inventaris_habispakai_opname` = `b`.`id_inv_inventaris_habispakai_opname`))) where ((`b`.`batch` = `inv_inventaris_habispakai_pembelian_item`.`batch`) and (`b`.`id_mst_inv_barang_habispakai` = `inv_inventaris_habispakai_pembelian_item`.`id_mst_inv_barang_habispakai`) and (`a`.`tipe` = 'terimarusak'))),0))),0) AS `jml_rusakakhir`,if((ifnull((select `inv_inventaris_habispakai_opname`.`tgl_opname` from (`inv_inventaris_habispakai_opname` left join `inv_inventaris_habispakai_opname_item` on((`inv_inventaris_habispakai_opname`.`id_inv_inventaris_habispakai_opname` = `inv_inventaris_habispakai_opname_item`.`id_inv_inventaris_habispakai_opname`))) where ((`inv_inventaris_habispakai_opname_item`.`batch` = `inv_inventaris_habispakai_pembelian_item`.`batch`) and (`inv_inventaris_habispakai_opname_item`.`id_mst_inv_barang_habispakai` = `inv_inventaris_habispakai_pembelian_item`.`id_mst_inv_barang_habispakai`)) order by `inv_inventaris_habispakai_opname`.`tgl_opname` desc limit 1),(curdate() + interval 1 day)) < curdate()),ifnull((select `inv_inventaris_habispakai_opname_item`.`harga` from (`inv_inventaris_habispakai_opname` left join `inv_inventaris_habispakai_opname_item` on((`inv_inventaris_habispakai_opname`.`id_inv_inventaris_habispakai_opname` = `inv_inventaris_habispakai_opname_item`.`id_inv_inventaris_habispakai_opname`))) where ((`inv_inventaris_habispakai_opname_item`.`batch` = `inv_inventaris_habispakai_pembelian_item`.`batch`) and (`inv_inventaris_habispakai_opname_item`.`id_mst_inv_barang_habispakai` = `inv_inventaris_habispakai_pembelian_item`.`id_mst_inv_barang_habispakai`)) order by `inv_inventaris_habispakai_opname`.`tgl_opname` desc limit 1),0),ifnull((select `m`.`harga` from (`inv_inventaris_habispakai_pembelian` `s` left join `inv_inventaris_habispakai_pembelian_item` `m` on((`s`.`id_inv_hasbispakai_pembelian` = `m`.`id_inv_hasbispakai_pembelian`))) where ((`m`.`batch` = `inv_inventaris_habispakai_pembelian_item`.`batch`) and (`m`.`id_mst_inv_barang_habispakai` = `inv_inventaris_habispakai_pembelian_item`.`id_mst_inv_barang_habispakai`)) order by `m`.`tgl_update` desc limit 1),0)) AS `hargaterakhir`,ifnull((ifnull((select `j`.`jml_akhir` from (`inv_inventaris_habispakai_opname_item` `j` join `inv_inventaris_habispakai_opname` `k` on((`j`.`id_inv_inventaris_habispakai_opname` = `k`.`id_inv_inventaris_habispakai_opname`))) where ((`j`.`id_mst_inv_barang_habispakai` = `inv_inventaris_habispakai_pembelian_item`.`id_mst_inv_barang_habispakai`) and (`j`.`batch` = `inv_inventaris_habispakai_pembelian_item`.`batch`)) order by `k`.`tgl_opname` desc limit 1),0) + ifnull((select sum(`inv_inventaris_habispakai_distribusi_item`.`jml`) from (`inv_inventaris_habispakai_distribusi_item` join `inv_inventaris_habispakai_distribusi` on((`inv_inventaris_habispakai_distribusi`.`id_inv_inventaris_habispakai_distribusi` = `inv_inventaris_habispakai_distribusi_item`.`id_inv_inventaris_habispakai_distribusi`))) where ((`inv_inventaris_habispakai_distribusi_item`.`batch` = `inv_inventaris_habispakai_pembelian_item`.`batch`) and (`inv_inventaris_habispakai_distribusi_item`.`id_mst_inv_barang_habispakai` = `inv_inventaris_habispakai_pembelian_item`.`id_mst_inv_barang_habispakai`) and (`inv_inventaris_habispakai_distribusi`.`tgl_distribusi` > ifnull((select `k`.`tgl_opname` from (`inv_inventaris_habispakai_opname_item` `j` join `inv_inventaris_habispakai_opname` `k` on((`j`.`id_inv_inventaris_habispakai_opname` = `k`.`id_inv_inventaris_habispakai_opname`))) where ((`j`.`id_mst_inv_barang_habispakai` = `inv_inventaris_habispakai_pembelian_item`.`id_mst_inv_barang_habispakai`) and (`j`.`batch` = `inv_inventaris_habispakai_pembelian_item`.`batch`)) order by `k`.`tgl_opname` desc limit 1),0)))),0)),0) AS `jml_awalopname`,`inv_inventaris_habispakai_pembelian_item`.`id_mst_inv_barang_habispakai` AS `id_mst_inv_barang_habispakai`,`inv_inventaris_habispakai_pembelian_item`.`batch` AS `batch`,`inv_inventaris_habispakai_pembelian_item`.`harga` AS `harga`,`inv_inventaris_habispakai_pembelian_item`.`tgl_kadaluarsa` AS `tgl_kadaluarsa`,sum(`inv_inventaris_habispakai_pembelian_item`.`jml`) AS `total_penerimaan`,`mst_inv_pbf`.`nama` AS `nama`,(select `g`.`tgl_pembelian` from (`inv_inventaris_habispakai_pembelian` `g` left join `inv_inventaris_habispakai_pembelian_item` `h` on((`g`.`id_inv_hasbispakai_pembelian` = `h`.`id_inv_hasbispakai_pembelian`))) where ((`h`.`batch` = `inv_inventaris_habispakai_pembelian_item`.`batch`) and (`inv_inventaris_habispakai_pembelian`.`code_cl_phc` = `g`.`code_cl_phc`) and (`inv_inventaris_habispakai_pembelian_item`.`id_mst_inv_barang_habispakai` = `h`.`id_mst_inv_barang_habispakai`)) order by `g`.`tgl_pembelian` desc limit 1) AS `tgl_pembelian_terakhir`,`mst_inv_barang_habispakai`.`merek_tipe` AS `merek_tipe`,`mst_inv_barang_habispakai`.`uraian` AS `uraian`,`inv_inventaris_habispakai_pembelian`.`id_inv_hasbispakai_pembelian` AS `id_inv_hasbispakai_pembelian`,`inv_inventaris_habispakai_pembelian`.`id_mst_inv_barang_habispakai_jenis` AS `id_mst_inv_barang_habispakai_jenis`,`inv_inventaris_habispakai_pembelian`.`jenis_transaksi` AS `jenis_transaksi`,`inv_inventaris_habispakai_pembelian`.`mst_inv_pbf_code` AS `mst_inv_pbf_code`,`inv_inventaris_habispakai_pembelian`.`pilihan_status_pembelian` AS `pilihan_status_pembelian`,`inv_inventaris_habispakai_pembelian`.`pilihan_sumber_dana` AS `pilihan_sumber_dana`,`inv_inventaris_habispakai_pembelian`.`bln_periode` AS `bln_periode`,`inv_inventaris_habispakai_pembelian`.`thn_dana` AS `thn_dana`,`inv_inventaris_habispakai_pembelian`.`tgl_permohonan` AS `tgl_permohonan`,`inv_inventaris_habispakai_pembelian`.`tgl_pembelian` AS `tgl_pembelian`,`inv_inventaris_habispakai_pembelian`.`tgl_kwitansi` AS `tgl_kwitansi`,`inv_inventaris_habispakai_pembelian`.`nomor_kwitansi` AS `nomor_kwitansi`,`inv_inventaris_habispakai_pembelian`.`nomor_kontrak` AS `nomor_kontrak`,`inv_inventaris_habispakai_pembelian`.`jumlah_unit` AS `jumlah_unit`,`inv_inventaris_habispakai_pembelian`.`nilai_pembelian` AS `nilai_pembelian`,`inv_inventaris_habispakai_pembelian`.`keterangan` AS `keterangan`,`inv_inventaris_habispakai_pembelian`.`waktu_dibuat` AS `waktu_dibuat`,`inv_inventaris_habispakai_pembelian`.`terakhir_diubah` AS `terakhir_diubah`,`inv_inventaris_habispakai_pembelian`.`code_cl_phc` AS `code_cl_phc` from (((`inv_inventaris_habispakai_pembelian` left join `inv_inventaris_habispakai_pembelian_item` on((`inv_inventaris_habispakai_pembelian`.`id_inv_hasbispakai_pembelian` = `inv_inventaris_habispakai_pembelian_item`.`id_inv_hasbispakai_pembelian`))) left join `mst_inv_barang_habispakai` on((`inv_inventaris_habispakai_pembelian_item`.`id_mst_inv_barang_habispakai` = `mst_inv_barang_habispakai`.`id_mst_inv_barang_habispakai`))) left join `mst_inv_pbf` on((`mst_inv_pbf`.`code` = `inv_inventaris_habispakai_pembelian`.`mst_inv_pbf_code`))) where (`inv_inventaris_habispakai_pembelian`.`pilihan_status_pembelian` = '2') group by `inv_inventaris_habispakai_pembelian_item`.`id_mst_inv_barang_habispakai`,`inv_inventaris_habispakai_pembelian_item`.`batch`,`inv_inventaris_habispakai_pembelian`.`code_cl_phc`;
CREATE  VIEW `bhp_pemusnahan_rusak` AS select if((ifnull((select sum((`b`.`jml_awal` - `b`.`jml_akhir`)) AS `b` from (`inv_inventaris_habispakai_opname` `a` join `inv_inventaris_habispakai_opname_item` `b` on((`a`.`id_inv_inventaris_habispakai_opname` = `b`.`id_inv_inventaris_habispakai_opname`))) where ((`b`.`batch` = `inv_inventaris_habispakai_pembelian_item`.`batch`) and (`b`.`id_mst_inv_barang_habispakai` = `inv_inventaris_habispakai_pembelian_item`.`id_mst_inv_barang_habispakai`) and (`a`.`tipe` = 'retur'))),0) >= ifnull((select sum((`b`.`jml_awal` - `b`.`jml_akhir`)) AS `b` from (`inv_inventaris_habispakai_opname` `a` join `inv_inventaris_habispakai_opname_item` `b` on((`a`.`id_inv_inventaris_habispakai_opname` = `b`.`id_inv_inventaris_habispakai_opname`))) where ((`b`.`batch` = `inv_inventaris_habispakai_pembelian_item`.`batch`) and (`b`.`id_mst_inv_barang_habispakai` = `inv_inventaris_habispakai_pembelian_item`.`id_mst_inv_barang_habispakai`) and (`a`.`tipe` = 'terimarusak'))),0)),ifnull((sum(`inv_inventaris_habispakai_pembelian_item`.`jml_rusak`) - ifnull((select sum((`b`.`jml_awal` - `b`.`jml_akhir`)) from (`inv_inventaris_habispakai_opname` `a` join `inv_inventaris_habispakai_opname_item` `b` on((`a`.`id_inv_inventaris_habispakai_opname` = `b`.`id_inv_inventaris_habispakai_opname`))) where ((`b`.`batch` = `inv_inventaris_habispakai_pembelian_item`.`batch`) and (`b`.`id_mst_inv_barang_habispakai` = `inv_inventaris_habispakai_pembelian_item`.`id_mst_inv_barang_habispakai`) and (`a`.`tipe` = 'retur') and (`a`.`tgl_opname` < `tglrusak`()))),0)),0),ifnull((sum(`inv_inventaris_habispakai_pembelian_item`.`jml_rusak`) - ifnull((select sum((`b`.`jml_awal` - `b`.`jml_akhir`)) from (`inv_inventaris_habispakai_opname` `a` join `inv_inventaris_habispakai_opname_item` `b` on((`a`.`id_inv_inventaris_habispakai_opname` = `b`.`id_inv_inventaris_habispakai_opname`))) where ((`b`.`batch` = `inv_inventaris_habispakai_pembelian_item`.`batch`) and (`b`.`id_mst_inv_barang_habispakai` = `inv_inventaris_habispakai_pembelian_item`.`id_mst_inv_barang_habispakai`) and (`a`.`tipe` = 'terimarusak') and (`a`.`tgl_opname` < `tglrusak`()))),0)),0)) AS `jumlahrusak`,`tglrusak`() AS `tglrusak()`,`mst_inv_barang_habispakai`.`uraian` AS `uraian`,`mst_inv_barang_habispakai`.`merek_tipe` AS `merek_tipe`,ifnull((ifnull((select `j`.`jml_akhir` from (`inv_inventaris_habispakai_opname_item` `j` join `inv_inventaris_habispakai_opname` `k` on((`j`.`id_inv_inventaris_habispakai_opname` = `k`.`id_inv_inventaris_habispakai_opname`))) where ((`j`.`id_mst_inv_barang_habispakai` = `inv_inventaris_habispakai_pembelian_item`.`id_mst_inv_barang_habispakai`) and (`j`.`batch` = `inv_inventaris_habispakai_pembelian_item`.`batch`)) order by `k`.`tgl_opname` desc limit 1),0) + ifnull((select sum(`inv_inventaris_habispakai_distribusi_item`.`jml`) from (`inv_inventaris_habispakai_distribusi_item` join `inv_inventaris_habispakai_distribusi` on((`inv_inventaris_habispakai_distribusi`.`id_inv_inventaris_habispakai_distribusi` = `inv_inventaris_habispakai_distribusi_item`.`id_inv_inventaris_habispakai_distribusi`))) where ((`inv_inventaris_habispakai_distribusi_item`.`batch` = `inv_inventaris_habispakai_pembelian_item`.`batch`) and (`inv_inventaris_habispakai_distribusi_item`.`id_mst_inv_barang_habispakai` = `inv_inventaris_habispakai_pembelian_item`.`id_mst_inv_barang_habispakai`) and (`inv_inventaris_habispakai_distribusi`.`tgl_distribusi` > ifnull((select `k`.`tgl_opname` from (`inv_inventaris_habispakai_opname_item` `j` join `inv_inventaris_habispakai_opname` `k` on((`j`.`id_inv_inventaris_habispakai_opname` = `k`.`id_inv_inventaris_habispakai_opname`))) where ((`j`.`id_mst_inv_barang_habispakai` = `inv_inventaris_habispakai_pembelian_item`.`id_mst_inv_barang_habispakai`) and (`j`.`batch` = `inv_inventaris_habispakai_pembelian_item`.`batch`)) order by `k`.`tgl_opname` desc limit 1),0)))),0)),0) AS `jml_awalopname`,sum(`inv_inventaris_habispakai_pembelian_item`.`jml_rusak`) AS `jml_rusak`,`inv_inventaris_habispakai_pembelian_item`.`id_mst_inv_barang_habispakai` AS `id_mst_inv_barang_habispakai`,`inv_inventaris_habispakai_pembelian_item`.`batch` AS `batch`,`inv_inventaris_habispakai_pembelian_item`.`tgl_kadaluarsa` AS `tgl_kadaluarsa`,`inv_inventaris_habispakai_pembelian`.`id_inv_hasbispakai_pembelian` AS `id_inv_hasbispakai_pembelian`,`inv_inventaris_habispakai_pembelian`.`id_mst_inv_barang_habispakai_jenis` AS `id_mst_inv_barang_habispakai_jenis`,`inv_inventaris_habispakai_pembelian`.`jenis_transaksi` AS `jenis_transaksi`,`inv_inventaris_habispakai_pembelian`.`mst_inv_pbf_code` AS `mst_inv_pbf_code`,`inv_inventaris_habispakai_pembelian`.`pilihan_status_pembelian` AS `pilihan_status_pembelian`,`inv_inventaris_habispakai_pembelian`.`pilihan_sumber_dana` AS `pilihan_sumber_dana`,`inv_inventaris_habispakai_pembelian`.`bln_periode` AS `bln_periode`,`inv_inventaris_habispakai_pembelian`.`thn_dana` AS `thn_dana`,`inv_inventaris_habispakai_pembelian`.`tgl_permohonan` AS `tgl_permohonan`,`inv_inventaris_habispakai_pembelian`.`tgl_pembelian` AS `tgl_pembelian`,`inv_inventaris_habispakai_pembelian`.`tgl_kwitansi` AS `tgl_kwitansi`,`inv_inventaris_habispakai_pembelian`.`nomor_kwitansi` AS `nomor_kwitansi`,`inv_inventaris_habispakai_pembelian`.`nomor_kontrak` AS `nomor_kontrak`,`inv_inventaris_habispakai_pembelian`.`jumlah_unit` AS `jumlah_unit`,`inv_inventaris_habispakai_pembelian`.`nilai_pembelian` AS `nilai_pembelian`,`inv_inventaris_habispakai_pembelian`.`keterangan` AS `keterangan`,`inv_inventaris_habispakai_pembelian`.`waktu_dibuat` AS `waktu_dibuat`,`inv_inventaris_habispakai_pembelian`.`terakhir_diubah` AS `terakhir_diubah`,`inv_inventaris_habispakai_pembelian`.`code_cl_phc` AS `code_cl_phc`,if((ifnull((select `inv_inventaris_habispakai_opname`.`tgl_opname` from (`inv_inventaris_habispakai_opname` left join `inv_inventaris_habispakai_opname_item` on((`inv_inventaris_habispakai_opname`.`id_inv_inventaris_habispakai_opname` = `inv_inventaris_habispakai_opname_item`.`id_inv_inventaris_habispakai_opname`))) where ((`inv_inventaris_habispakai_opname_item`.`batch` = `inv_inventaris_habispakai_pembelian_item`.`batch`) and (`inv_inventaris_habispakai_opname_item`.`id_mst_inv_barang_habispakai` = `inv_inventaris_habispakai_pembelian_item`.`id_mst_inv_barang_habispakai`)) order by `inv_inventaris_habispakai_opname`.`tgl_opname` desc limit 1),(curdate() + interval 1 day)) < curdate()),ifnull((select `inv_inventaris_habispakai_opname_item`.`harga` from (`inv_inventaris_habispakai_opname` left join `inv_inventaris_habispakai_opname_item` on((`inv_inventaris_habispakai_opname`.`id_inv_inventaris_habispakai_opname` = `inv_inventaris_habispakai_opname_item`.`id_inv_inventaris_habispakai_opname`))) where ((`inv_inventaris_habispakai_opname_item`.`batch` = `inv_inventaris_habispakai_pembelian_item`.`batch`) and (`inv_inventaris_habispakai_opname_item`.`id_mst_inv_barang_habispakai` = `inv_inventaris_habispakai_pembelian_item`.`id_mst_inv_barang_habispakai`)) order by `inv_inventaris_habispakai_opname`.`tgl_opname` desc limit 1),0),ifnull((select `inv_inventaris_habispakai_pembelian_item`.`harga` from (`inv_inventaris_habispakai_pembelian` `h` left join `inv_inventaris_habispakai_pembelian_item` `i` on((`h`.`id_inv_hasbispakai_pembelian` = `i`.`id_inv_hasbispakai_pembelian`))) where ((`i`.`batch` = `inv_inventaris_habispakai_pembelian_item`.`batch`) and (`i`.`id_mst_inv_barang_habispakai` = `inv_inventaris_habispakai_pembelian_item`.`id_mst_inv_barang_habispakai`)) order by `i`.`tgl_update` desc limit 1),0)) AS `hargaterakhir` from ((`inv_inventaris_habispakai_pembelian_item` join `inv_inventaris_habispakai_pembelian` on((`inv_inventaris_habispakai_pembelian_item`.`id_inv_hasbispakai_pembelian` = `inv_inventaris_habispakai_pembelian`.`id_inv_hasbispakai_pembelian`))) join `mst_inv_barang_habispakai` on((`mst_inv_barang_habispakai`.`id_mst_inv_barang_habispakai` = `inv_inventaris_habispakai_pembelian_item`.`id_mst_inv_barang_habispakai`))) group by `inv_inventaris_habispakai_pembelian`.`code_cl_phc`,`inv_inventaris_habispakai_pembelian_item`.`id_mst_inv_barang_habispakai`,`inv_inventaris_habispakai_pembelian_item`.`batch` having (`jumlahrusak` > 0);
CREATE  VIEW `bhp_kondisi_opname2` AS select ifnull((ifnull((select `j`.`jml_akhir` from (`inv_inventaris_habispakai_opname_item` `j` join `inv_inventaris_habispakai_opname` `k` on((`j`.`id_inv_inventaris_habispakai_opname` = `k`.`id_inv_inventaris_habispakai_opname`))) where ((`j`.`id_mst_inv_barang_habispakai` = `inv_inventaris_habispakai_kondisi`.`id_mst_inv_barang_habispakai`) and (`j`.`batch` = `inv_inventaris_habispakai_kondisi`.`batch`)) order by `k`.`tgl_opname` desc limit 1),0) + ifnull((select sum(`inv_inventaris_habispakai_distribusi_item`.`jml`) from (`inv_inventaris_habispakai_distribusi_item` join `inv_inventaris_habispakai_distribusi` on((`inv_inventaris_habispakai_distribusi`.`id_inv_inventaris_habispakai_distribusi` = `inv_inventaris_habispakai_distribusi_item`.`id_inv_inventaris_habispakai_distribusi`))) where ((`inv_inventaris_habispakai_distribusi_item`.`batch` = `inv_inventaris_habispakai_kondisi`.`batch`) and (`inv_inventaris_habispakai_distribusi_item`.`id_mst_inv_barang_habispakai` = `inv_inventaris_habispakai_kondisi`.`id_mst_inv_barang_habispakai`) and (`inv_inventaris_habispakai_distribusi`.`tgl_distribusi` > ifnull((select `k`.`tgl_opname` from (`inv_inventaris_habispakai_opname_item` `j` join `inv_inventaris_habispakai_opname` `k` on((`j`.`id_inv_inventaris_habispakai_opname` = `k`.`id_inv_inventaris_habispakai_opname`))) where ((`j`.`id_mst_inv_barang_habispakai` = `inv_inventaris_habispakai_kondisi`.`id_mst_inv_barang_habispakai`) and (`j`.`batch` = `inv_inventaris_habispakai_kondisi`.`batch`)) order by `k`.`tgl_opname` desc limit 1),0)))),0)),0) AS `jml_awalopname`,((select `a`.`jml_rusak` from `inv_inventaris_habispakai_kondisi` `a` where ((`a`.`id_mst_inv_barang_habispakai` = `inv_inventaris_habispakai_kondisi`.`id_mst_inv_barang_habispakai`) and (`a`.`batch` = `inv_inventaris_habispakai_kondisi`.`batch`)) order by `a`.`tgl_update` desc limit 1) + (select `a`.`jml_tdkdipakai` from `inv_inventaris_habispakai_kondisi` `a` where ((`a`.`id_mst_inv_barang_habispakai` = `inv_inventaris_habispakai_kondisi`.`id_mst_inv_barang_habispakai`) and (`a`.`batch` = `inv_inventaris_habispakai_kondisi`.`batch`)) order by `a`.`tgl_update` desc limit 1)) AS `jumlahtidakdipakai`,(ifnull(((select `a`.`jml_rusak` from `inv_inventaris_habispakai_kondisi` `a` where ((`a`.`id_mst_inv_barang_habispakai` = `inv_inventaris_habispakai_kondisi`.`id_mst_inv_barang_habispakai`) and (`a`.`batch` = `inv_inventaris_habispakai_kondisi`.`batch`)) order by `a`.`tgl_update` desc limit 1) + (select `a`.`jml_tdkdipakai` from `inv_inventaris_habispakai_kondisi` `a` where ((`a`.`id_mst_inv_barang_habispakai` = `inv_inventaris_habispakai_kondisi`.`id_mst_inv_barang_habispakai`) and (`a`.`batch` = `inv_inventaris_habispakai_kondisi`.`batch`)) order by `a`.`tgl_update` desc limit 1)),0) - ifnull((select sum((`r`.`jml_awal` - `r`.`jml_akhir`)) from (`inv_inventaris_habispakai_opname_item` `r` join `inv_inventaris_habispakai_opname` `s` on((`r`.`id_inv_inventaris_habispakai_opname` = `s`.`id_inv_inventaris_habispakai_opname`))) where ((`r`.`batch` = `inv_inventaris_habispakai_kondisi`.`batch`) and (`r`.`id_mst_inv_barang_habispakai` = `inv_inventaris_habispakai_kondisi`.`id_mst_inv_barang_habispakai`) and (`s`.`tipe` = 'tidakdipakai') and (`s`.`tgl_opname` < `tglkondisi`()))),0)) AS `jumlahtidakdipakaiterakhir`,(select `a`.`tgl_update` from `inv_inventaris_habispakai_kondisi` `a` where ((`a`.`id_mst_inv_barang_habispakai` = `inv_inventaris_habispakai_kondisi`.`id_mst_inv_barang_habispakai`) and (`a`.`batch` = `inv_inventaris_habispakai_kondisi`.`batch`)) order by `a`.`tgl_update` desc limit 1) AS `tgl_updateterakhir`,`inv_inventaris_habispakai_kondisi`.`id_mst_inv_barang_habispakai` AS `id_mst_inv_barang_habispakai`,`inv_inventaris_habispakai_kondisi`.`batch` AS `batch`,`inv_inventaris_habispakai_kondisi`.`code_cl_phc` AS `code_cl_phc`,`inv_inventaris_habispakai_kondisi`.`tgl_update` AS `tgl_update`,`inv_inventaris_habispakai_kondisi`.`jml_rusak` AS `jml_rusak`,`inv_inventaris_habispakai_kondisi`.`jml_tdkdipakai` AS `jml_tdkdipakai`,`inv_inventaris_habispakai_kondisi`.`id_inv_inventaris_habispakai_opname` AS `id_inv_inventaris_habispakai_opname`,`mst_inv_barang_habispakai`.`uraian` AS `uraian`,`mst_inv_barang_habispakai`.`merek_tipe` AS `merek_tipe`,`mst_inv_barang_habispakai`.`id_mst_inv_barang_habispakai_jenis` AS `id_mst_inv_barang_habispakai_jenis`,if((ifnull((select `inv_inventaris_habispakai_opname`.`tgl_opname` from (`inv_inventaris_habispakai_opname` left join `inv_inventaris_habispakai_opname_item` on((`inv_inventaris_habispakai_opname`.`id_inv_inventaris_habispakai_opname` = `inv_inventaris_habispakai_opname_item`.`id_inv_inventaris_habispakai_opname`))) where ((`inv_inventaris_habispakai_opname_item`.`batch` = `inv_inventaris_habispakai_kondisi`.`batch`) and (`inv_inventaris_habispakai_opname_item`.`id_mst_inv_barang_habispakai` = `inv_inventaris_habispakai_kondisi`.`id_mst_inv_barang_habispakai`)) order by `inv_inventaris_habispakai_opname`.`tgl_opname` desc limit 1),(curdate() + interval 1 day)) < curdate()),ifnull((select `inv_inventaris_habispakai_opname_item`.`harga` from (`inv_inventaris_habispakai_opname` left join `inv_inventaris_habispakai_opname_item` on((`inv_inventaris_habispakai_opname`.`id_inv_inventaris_habispakai_opname` = `inv_inventaris_habispakai_opname_item`.`id_inv_inventaris_habispakai_opname`))) where ((`inv_inventaris_habispakai_opname_item`.`batch` = `inv_inventaris_habispakai_kondisi`.`batch`) and (`inv_inventaris_habispakai_opname_item`.`id_mst_inv_barang_habispakai` = `inv_inventaris_habispakai_kondisi`.`id_mst_inv_barang_habispakai`)) order by `inv_inventaris_habispakai_opname`.`tgl_opname` desc limit 1),0),ifnull((select `i`.`harga` from (`inv_inventaris_habispakai_pembelian` `h` left join `inv_inventaris_habispakai_pembelian_item` `i` on((`h`.`id_inv_hasbispakai_pembelian` = `i`.`id_inv_hasbispakai_pembelian`))) where ((`i`.`batch` = `inv_inventaris_habispakai_kondisi`.`batch`) and (`i`.`id_mst_inv_barang_habispakai` = `inv_inventaris_habispakai_kondisi`.`id_mst_inv_barang_habispakai`)) order by `i`.`tgl_update` desc limit 1),0)) AS `hargaterakhir` from (`inv_inventaris_habispakai_kondisi` join `mst_inv_barang_habispakai` on((`inv_inventaris_habispakai_kondisi`.`id_mst_inv_barang_habispakai` = `mst_inv_barang_habispakai`.`id_mst_inv_barang_habispakai`))) group by `inv_inventaris_habispakai_kondisi`.`id_mst_inv_barang_habispakai`,`inv_inventaris_habispakai_kondisi`.`batch`,`inv_inventaris_habispakai_kondisi`.`code_cl_phc` having ((`jumlahtidakdipakaiterakhir` > 0) and (`jml_awalopname` > 0));
CREATE  VIEW `bhp_kondisi` AS select `inv_inventaris_habispakai_kondisi`.`batch` AS `batch`,`inv_inventaris_habispakai_kondisi`.`code_cl_phc` AS `code_cl_phc`,`inv_inventaris_habispakai_kondisi`.`id_inv_inventaris_habispakai_opname` AS `id_inv_inventaris_habispakai_opname`,`inv_inventaris_habispakai_kondisi`.`id_mst_inv_barang_habispakai` AS `id_mst_inv_barang_habispakai`,(select `c`.`jml_rusak` from `inv_inventaris_habispakai_kondisi` `c` where ((`c`.`id_mst_inv_barang_habispakai` = `inv_inventaris_habispakai_kondisi`.`id_mst_inv_barang_habispakai`) and (`c`.`batch` = `inv_inventaris_habispakai_kondisi`.`batch`) and (`c`.`code_cl_phc` = `inv_inventaris_habispakai_kondisi`.`code_cl_phc`)) order by `c`.`tgl_update` desc limit 1) AS `jml_rusak`,(select `c`.`jml_tdkdipakai` from `inv_inventaris_habispakai_kondisi` `c` where ((`c`.`id_mst_inv_barang_habispakai` = `inv_inventaris_habispakai_kondisi`.`id_mst_inv_barang_habispakai`) and (`c`.`batch` = `inv_inventaris_habispakai_kondisi`.`batch`) and (`c`.`code_cl_phc` = `inv_inventaris_habispakai_kondisi`.`code_cl_phc`)) order by `c`.`tgl_update` desc limit 1) AS `jml_tdkdipakai`,(select `h`.`tgl_update` from `inv_inventaris_habispakai_kondisi` `h` where ((`h`.`id_mst_inv_barang_habispakai` = `inv_inventaris_habispakai_kondisi`.`id_mst_inv_barang_habispakai`) and (`h`.`batch` = `inv_inventaris_habispakai_kondisi`.`batch`) and (`h`.`code_cl_phc` = `inv_inventaris_habispakai_kondisi`.`code_cl_phc`)) order by `h`.`tgl_update` desc limit 1) AS `tgl_update`,`mst_inv_barang_habispakai`.`uraian` AS `uraian`,(ifnull((select `inv_inventaris_habispakai_opname_item`.`jml_akhir` from (`inv_inventaris_habispakai_opname_item` join `inv_inventaris_habispakai_opname` on((`inv_inventaris_habispakai_opname`.`id_inv_inventaris_habispakai_opname` = `inv_inventaris_habispakai_opname_item`.`id_inv_inventaris_habispakai_opname`))) where ((`inv_inventaris_habispakai_opname_item`.`id_mst_inv_barang_habispakai` = `inv_inventaris_habispakai_kondisi`.`id_mst_inv_barang_habispakai`) and (`inv_inventaris_habispakai_opname_item`.`batch` = `inv_inventaris_habispakai_kondisi`.`batch`)) order by `inv_inventaris_habispakai_opname`.`tgl_opname` desc limit 1),0) + ifnull((select sum(`inv_inventaris_habispakai_distribusi_item`.`jml`) from (`inv_inventaris_habispakai_distribusi_item` left join `inv_inventaris_habispakai_distribusi` on((`inv_inventaris_habispakai_distribusi`.`id_inv_inventaris_habispakai_distribusi` = `inv_inventaris_habispakai_distribusi_item`.`id_inv_inventaris_habispakai_distribusi`))) where ((`inv_inventaris_habispakai_distribusi_item`.`id_mst_inv_barang_habispakai` = `inv_inventaris_habispakai_kondisi`.`id_mst_inv_barang_habispakai`) and (`inv_inventaris_habispakai_distribusi_item`.`batch` = `inv_inventaris_habispakai_kondisi`.`batch`) and (`inv_inventaris_habispakai_distribusi`.`tgl_distribusi` > ifnull((select `b`.`tgl_opname` from (`inv_inventaris_habispakai_opname_item` `a` join `inv_inventaris_habispakai_opname` `b` on((`a`.`id_inv_inventaris_habispakai_opname` = `b`.`id_inv_inventaris_habispakai_opname`))) where ((`a`.`id_mst_inv_barang_habispakai` = `inv_inventaris_habispakai_distribusi_item`.`id_mst_inv_barang_habispakai`) and (`a`.`batch` = `inv_inventaris_habispakai_distribusi_item`.`batch`)) order by `b`.`tgl_opname` desc limit 1),'0000-00-00')))),0)) AS `jml_asli`,`mst_inv_barang_habispakai`.`id_mst_inv_barang_habispakai_jenis` AS `id_mst_inv_barang_habispakai_jenis`,`mst_inv_barang_habispakai`.`pilihan_satuan` AS `pilihan_satuan`,(select `inv_inventaris_habispakai_opname_item`.`harga` from `inv_inventaris_habispakai_opname_item` where ((`inv_inventaris_habispakai_opname_item`.`id_inv_inventaris_habispakai_opname` = `inv_inventaris_habispakai_kondisi`.`id_inv_inventaris_habispakai_opname`) and (`inv_inventaris_habispakai_opname_item`.`id_mst_inv_barang_habispakai` = `inv_inventaris_habispakai_kondisi`.`id_mst_inv_barang_habispakai`) and (`inv_inventaris_habispakai_opname_item`.`batch` = `inv_inventaris_habispakai_kondisi`.`batch`))) AS `harga` from (`inv_inventaris_habispakai_kondisi` join `mst_inv_barang_habispakai` on((`mst_inv_barang_habispakai`.`id_mst_inv_barang_habispakai` = `inv_inventaris_habispakai_kondisi`.`id_mst_inv_barang_habispakai`))) group by `inv_inventaris_habispakai_kondisi`.`id_mst_inv_barang_habispakai`,`inv_inventaris_habispakai_kondisi`.`batch`,`inv_inventaris_habispakai_kondisi`.`code_cl_phc`;
CREATE  VIEW `bhp_expired` AS select ifnull(if(((select `inv_inventaris_habispakai_pembelian_item`.`tgl_kadaluarsa` from `inv_inventaris_habispakai_pembelian_item` where ((`inv_inventaris_habispakai_pembelian_item`.`id_mst_inv_barang_habispakai` = `inv_inventaris_habispakai_opname_item`.`id_mst_inv_barang_habispakai`) and (`inv_inventaris_habispakai_pembelian_item`.`batch` = `inv_inventaris_habispakai_opname_item`.`batch`) and (`inv_inventaris_habispakai_pembelian_item`.`code_cl_phc` = `inv_inventaris_habispakai_opname`.`code_cl_phc`)) order by `inv_inventaris_habispakai_pembelian_item`.`tgl_kadaluarsa` desc limit 1) > curdate()),(to_days((select `inv_inventaris_habispakai_pembelian_item`.`tgl_kadaluarsa` from `inv_inventaris_habispakai_pembelian_item` where ((`inv_inventaris_habispakai_pembelian_item`.`id_mst_inv_barang_habispakai` = `inv_inventaris_habispakai_opname_item`.`id_mst_inv_barang_habispakai`) and (`inv_inventaris_habispakai_pembelian_item`.`batch` = `inv_inventaris_habispakai_opname_item`.`batch`) and (`inv_inventaris_habispakai_pembelian_item`.`code_cl_phc` = `inv_inventaris_habispakai_opname`.`code_cl_phc`)) order by `inv_inventaris_habispakai_pembelian_item`.`tgl_kadaluarsa` desc limit 1)) - to_days(curdate())),0),0) AS `jmlexpired`,`inv_inventaris_habispakai_opname_item`.`id_inv_inventaris_habispakai_opname` AS `id_inv_inventaris_habispakai_opname`,`inv_inventaris_habispakai_opname_item`.`id_mst_inv_barang_habispakai` AS `id_mst_inv_barang_habispakai`,`inv_inventaris_habispakai_opname_item`.`batch` AS `batch`,(select `inv_inventaris_habispakai_pembelian_item`.`tgl_kadaluarsa` from `inv_inventaris_habispakai_pembelian_item` where ((`inv_inventaris_habispakai_pembelian_item`.`id_mst_inv_barang_habispakai` = `inv_inventaris_habispakai_opname_item`.`id_mst_inv_barang_habispakai`) and (`inv_inventaris_habispakai_pembelian_item`.`batch` = `inv_inventaris_habispakai_opname_item`.`batch`) and (`inv_inventaris_habispakai_pembelian_item`.`code_cl_phc` = `inv_inventaris_habispakai_opname`.`code_cl_phc`)) order by `inv_inventaris_habispakai_pembelian_item`.`tgl_kadaluarsa` desc limit 1) AS `tgl_kadaluarsa`,(select `mst_inv_pilihan`.`value` from ((`inv_inventaris_habispakai_pembelian_item` join `inv_inventaris_habispakai_pembelian` on((`inv_inventaris_habispakai_pembelian`.`id_inv_hasbispakai_pembelian` = `inv_inventaris_habispakai_pembelian_item`.`id_inv_hasbispakai_pembelian`))) left join `mst_inv_pilihan` on(((convert(`inv_inventaris_habispakai_pembelian`.`pilihan_sumber_dana` using utf8) = `mst_inv_pilihan`.`code`) and (`mst_inv_pilihan`.`tipe` = 'sumber_dana')))) where ((`inv_inventaris_habispakai_pembelian_item`.`id_mst_inv_barang_habispakai` = `inv_inventaris_habispakai_opname_item`.`id_mst_inv_barang_habispakai`) and (`inv_inventaris_habispakai_pembelian_item`.`batch` = `inv_inventaris_habispakai_opname_item`.`batch`) and (`inv_inventaris_habispakai_pembelian_item`.`code_cl_phc` = `inv_inventaris_habispakai_opname`.`code_cl_phc`)) limit 1) AS `pilihan_sumber_dana`,`inv_inventaris_habispakai_opname_item`.`jml_awal` AS `jml_awal`,`inv_inventaris_habispakai_opname_item`.`jml_akhir` AS `jml_akhir`,`inv_inventaris_habispakai_opname_item`.`harga` AS `harga`,`mst_inv_barang_habispakai`.`uraian` AS `uraian`,`mst_inv_barang_habispakai`.`id_mst_inv_barang_habispakai_jenis` AS `id_mst_inv_barang_habispakai_jenis`,`mst_inv_barang_habispakai`.`pilihan_satuan` AS `pilihan_satuan`,`mst_inv_barang_habispakai`.`merek_tipe` AS `merek_tipe`,`inv_inventaris_habispakai_opname`.`tgl_opname` AS `tgl_opname`,`inv_inventaris_habispakai_opname`.`nomor_opname` AS `nomor_opname`,`inv_inventaris_habispakai_opname`.`code_cl_phc` AS `code_cl_phc`,`inv_inventaris_habispakai_opname`.`catatan` AS `catatan`,`inv_inventaris_habispakai_opname`.`jenis_bhp` AS `jenis_bhp`,`inv_inventaris_habispakai_opname`.`petugas_nama` AS `petugas_nama`,sum(`inv_inventaris_habispakai_opname_item`.`jml_akhir`) AS `sumjml_akhir`,sum(`inv_inventaris_habispakai_opname_item`.`jml_awal`) AS `sumjml_awal`,sum((`inv_inventaris_habispakai_opname_item`.`jml_akhir` - `inv_inventaris_habispakai_opname_item`.`jml_awal`)) AS `sumselisih`,ifnull((select `a`.`jml_akhir` from (`inv_inventaris_habispakai_opname_item` `a` join `inv_inventaris_habispakai_opname` `b` on((`a`.`id_inv_inventaris_habispakai_opname` = `b`.`id_inv_inventaris_habispakai_opname`))) where ((`a`.`batch` = `inv_inventaris_habispakai_opname_item`.`batch`) and (`a`.`id_mst_inv_barang_habispakai` = `inv_inventaris_habispakai_opname_item`.`id_mst_inv_barang_habispakai`)) order by `b`.`tgl_opname` desc limit 1),0) AS `totalopname`,ifnull((select sum(`inv_inventaris_habispakai_distribusi_item`.`jml`) from (`inv_inventaris_habispakai_distribusi_item` join `inv_inventaris_habispakai_distribusi` on((`inv_inventaris_habispakai_distribusi`.`id_inv_inventaris_habispakai_distribusi` = `inv_inventaris_habispakai_distribusi_item`.`id_inv_inventaris_habispakai_distribusi`))) where ((`inv_inventaris_habispakai_distribusi_item`.`id_mst_inv_barang_habispakai` = `inv_inventaris_habispakai_opname_item`.`id_mst_inv_barang_habispakai`) and (`inv_inventaris_habispakai_distribusi_item`.`batch` = `inv_inventaris_habispakai_opname_item`.`batch`) and (`inv_inventaris_habispakai_distribusi`.`tgl_distribusi` > ifnull((select `d`.`tgl_opname` from (`inv_inventaris_habispakai_opname_item` `c` join `inv_inventaris_habispakai_opname` `d` on((`c`.`id_inv_inventaris_habispakai_opname` = `d`.`id_inv_inventaris_habispakai_opname`))) where ((`c`.`batch` = `inv_inventaris_habispakai_opname_item`.`batch`) and (`c`.`id_mst_inv_barang_habispakai` = `inv_inventaris_habispakai_opname_item`.`id_mst_inv_barang_habispakai`) and (month(`d`.`tgl_opname`) < month(`inv_inventaris_habispakai_opname`.`tgl_opname`)) and (year(`d`.`tgl_opname`) <= year(`inv_inventaris_habispakai_opname`.`tgl_opname`))) order by `d`.`tgl_opname` desc limit 1),'0000-00-00')) and (month(`inv_inventaris_habispakai_distribusi`.`tgl_distribusi`) <= month(`inv_inventaris_habispakai_opname`.`tgl_opname`)) and (year(`inv_inventaris_habispakai_distribusi`.`tgl_distribusi`) <= year(`inv_inventaris_habispakai_opname`.`tgl_opname`)))),0) AS `totaldistribusi`,(ifnull((select `a`.`jml_akhir` from (`inv_inventaris_habispakai_opname_item` `a` join `inv_inventaris_habispakai_opname` `b` on((`a`.`id_inv_inventaris_habispakai_opname` = `b`.`id_inv_inventaris_habispakai_opname`))) where ((`a`.`batch` = `inv_inventaris_habispakai_opname_item`.`batch`) and (`a`.`id_mst_inv_barang_habispakai` = `inv_inventaris_habispakai_opname_item`.`id_mst_inv_barang_habispakai`)) order by `b`.`tgl_opname` desc limit 1),0) + ifnull((select sum(`inv_inventaris_habispakai_distribusi_item`.`jml`) from (`inv_inventaris_habispakai_distribusi_item` join `inv_inventaris_habispakai_distribusi` on((`inv_inventaris_habispakai_distribusi`.`id_inv_inventaris_habispakai_distribusi` = `inv_inventaris_habispakai_distribusi_item`.`id_inv_inventaris_habispakai_distribusi`))) where ((`inv_inventaris_habispakai_distribusi_item`.`id_mst_inv_barang_habispakai` = `inv_inventaris_habispakai_opname_item`.`id_mst_inv_barang_habispakai`) and (`inv_inventaris_habispakai_distribusi_item`.`batch` = `inv_inventaris_habispakai_opname_item`.`batch`) and (`inv_inventaris_habispakai_distribusi`.`tgl_distribusi` > ifnull((select `d`.`tgl_opname` from (`inv_inventaris_habispakai_opname_item` `c` join `inv_inventaris_habispakai_opname` `d` on((`c`.`id_inv_inventaris_habispakai_opname` = `d`.`id_inv_inventaris_habispakai_opname`))) where ((`c`.`batch` = `inv_inventaris_habispakai_opname_item`.`batch`) and (`c`.`id_mst_inv_barang_habispakai` = `inv_inventaris_habispakai_opname_item`.`id_mst_inv_barang_habispakai`)) order by `d`.`tgl_opname` desc limit 1),'0000-00-00')) and (month(`inv_inventaris_habispakai_distribusi`.`tgl_distribusi`) <= month(`inv_inventaris_habispakai_opname`.`tgl_opname`)) and (year(`inv_inventaris_habispakai_distribusi`.`tgl_distribusi`) <= year(`inv_inventaris_habispakai_opname`.`tgl_opname`)))),0)) AS `jmlawal_opname` from ((`inv_inventaris_habispakai_opname_item` join `mst_inv_barang_habispakai` on((`mst_inv_barang_habispakai`.`id_mst_inv_barang_habispakai` = `inv_inventaris_habispakai_opname_item`.`id_mst_inv_barang_habispakai`))) join `inv_inventaris_habispakai_opname` on(((`inv_inventaris_habispakai_opname`.`id_inv_inventaris_habispakai_opname` = `inv_inventaris_habispakai_opname_item`.`id_inv_inventaris_habispakai_opname`) and (`mst_inv_barang_habispakai`.`id_mst_inv_barang_habispakai_jenis` = 8)))) group by `inv_inventaris_habispakai_opname_item`.`batch`,`inv_inventaris_habispakai_opname_item`.`id_mst_inv_barang_habispakai` order by `inv_inventaris_habispakai_opname_item`.`id_inv_inventaris_habispakai_opname`;
CREATE  VIEW `bhp_distribusi_opname` AS select `func`() AS `func()`,`mst_inv_barang_habispakai`.`merek_tipe` AS `merek_tipe`,`inv_inventaris_habispakai_distribusi`.`id_inv_inventaris_habispakai_distribusi` AS `id_inv_inventaris_habispakai_distribusi`,`inv_inventaris_habispakai_distribusi`.`code_cl_phc` AS `code_cl_phc`,`inv_inventaris_habispakai_distribusi`.`jenis_bhp` AS `jenis_bhp`,`inv_inventaris_habispakai_distribusi`.`bln_periode` AS `bln_periode`,`inv_inventaris_habispakai_distribusi`.`tgl_distribusi` AS `tgl_distribusi`,`inv_inventaris_habispakai_distribusi`.`nomor_dokumen` AS `nomor_dokumen`,`inv_inventaris_habispakai_distribusi`.`penerima_nama` AS `penerima_nama`,`inv_inventaris_habispakai_distribusi`.`penerima_nip` AS `penerima_nip`,`inv_inventaris_habispakai_distribusi`.`keterangan` AS `keterangan`,`inv_inventaris_habispakai_distribusi_item`.`id_mst_inv_barang_habispakai` AS `id_mst_inv_barang_habispakai`,`inv_inventaris_habispakai_distribusi_item`.`batch` AS `batch`,`mst_inv_barang_habispakai`.`uraian` AS `uraian`,`mst_inv_barang_habispakai`.`id_mst_inv_barang_habispakai_jenis` AS `id_mst_inv_barang_habispakai_jenis`,sum(`inv_inventaris_habispakai_distribusi_item`.`jml`) AS `jml_distribusi`,ifnull((select sum(`a`.`jml`) from (`inv_inventaris_habispakai_distribusi_item` `a` join `inv_inventaris_habispakai_distribusi` `b` on((`a`.`id_inv_inventaris_habispakai_distribusi` = `b`.`id_inv_inventaris_habispakai_distribusi`))) where ((`a`.`batch` = `inv_inventaris_habispakai_distribusi_item`.`batch`) and (`a`.`id_mst_inv_barang_habispakai` = `inv_inventaris_habispakai_distribusi_item`.`id_mst_inv_barang_habispakai`) and (`b`.`tgl_distribusi` > ifnull((select `c`.`tgl_opname` from (`inv_inventaris_habispakai_opname` `c` left join `inv_inventaris_habispakai_opname_item` `d` on((`c`.`id_inv_inventaris_habispakai_opname` = `d`.`id_inv_inventaris_habispakai_opname`))) where ((`d`.`batch` = `a`.`batch`) and (`d`.`id_mst_inv_barang_habispakai` = `a`.`id_mst_inv_barang_habispakai`)) order by `c`.`tgl_opname` desc limit 1),'0000-00-00')))),0) AS `jml_distribusi_opname`,ifnull((select `inv_inventaris_habispakai_pembelian_item`.`harga` from (`inv_inventaris_habispakai_pembelian` left join `inv_inventaris_habispakai_pembelian_item` on((`inv_inventaris_habispakai_pembelian`.`id_inv_hasbispakai_pembelian` = `inv_inventaris_habispakai_pembelian_item`.`id_inv_hasbispakai_pembelian`))) where ((`inv_inventaris_habispakai_pembelian_item`.`batch` = `inv_inventaris_habispakai_distribusi_item`.`batch`) and (`inv_inventaris_habispakai_pembelian_item`.`id_mst_inv_barang_habispakai` = `inv_inventaris_habispakai_distribusi_item`.`id_mst_inv_barang_habispakai`)) order by `inv_inventaris_habispakai_pembelian_item`.`tgl_update` desc limit 1),'0') AS `harga_beli`,ifnull((select `inv_inventaris_habispakai_pembelian_item`.`tgl_update` from (`inv_inventaris_habispakai_pembelian` left join `inv_inventaris_habispakai_pembelian_item` on((`inv_inventaris_habispakai_pembelian`.`id_inv_hasbispakai_pembelian` = `inv_inventaris_habispakai_pembelian_item`.`id_inv_hasbispakai_pembelian`))) where ((`inv_inventaris_habispakai_pembelian_item`.`batch` = `inv_inventaris_habispakai_distribusi_item`.`batch`) and (`inv_inventaris_habispakai_pembelian_item`.`id_mst_inv_barang_habispakai` = `inv_inventaris_habispakai_distribusi_item`.`id_mst_inv_barang_habispakai`)) order by `inv_inventaris_habispakai_pembelian_item`.`tgl_update` desc limit 1),'0000-00-00') AS `tgl_beli`,ifnull((select `inv_inventaris_habispakai_opname`.`tgl_opname` from (`inv_inventaris_habispakai_opname` left join `inv_inventaris_habispakai_opname_item` on((`inv_inventaris_habispakai_opname`.`id_inv_inventaris_habispakai_opname` = `inv_inventaris_habispakai_opname_item`.`id_inv_inventaris_habispakai_opname`))) where ((`inv_inventaris_habispakai_opname_item`.`batch` = `inv_inventaris_habispakai_distribusi_item`.`batch`) and (`inv_inventaris_habispakai_opname_item`.`id_mst_inv_barang_habispakai` = `inv_inventaris_habispakai_distribusi_item`.`id_mst_inv_barang_habispakai`)) order by `inv_inventaris_habispakai_opname`.`tgl_opname` desc limit 1),'0000-00-00') AS `tgl_opname`,ifnull((select `inv_inventaris_habispakai_pembelian_item`.`tgl_kadaluarsa` from (`inv_inventaris_habispakai_pembelian_item` left join `inv_inventaris_habispakai_pembelian` on((`inv_inventaris_habispakai_pembelian_item`.`id_inv_hasbispakai_pembelian` = `inv_inventaris_habispakai_pembelian`.`id_inv_hasbispakai_pembelian`))) where ((`inv_inventaris_habispakai_pembelian_item`.`batch` = `inv_inventaris_habispakai_distribusi_item`.`batch`) and (`inv_inventaris_habispakai_pembelian_item`.`id_mst_inv_barang_habispakai` = `inv_inventaris_habispakai_distribusi_item`.`id_mst_inv_barang_habispakai`)) order by `inv_inventaris_habispakai_pembelian`.`tgl_pembelian` desc limit 1),'0000-00-00') AS `tgl_kadaluarsa`,ifnull((select `inv_inventaris_habispakai_opname_item`.`harga` from (`inv_inventaris_habispakai_opname` left join `inv_inventaris_habispakai_opname_item` on((`inv_inventaris_habispakai_opname`.`id_inv_inventaris_habispakai_opname` = `inv_inventaris_habispakai_opname_item`.`id_inv_inventaris_habispakai_opname`))) where ((`inv_inventaris_habispakai_opname_item`.`batch` = `inv_inventaris_habispakai_distribusi_item`.`batch`) and (`inv_inventaris_habispakai_opname_item`.`id_mst_inv_barang_habispakai` = `inv_inventaris_habispakai_distribusi_item`.`id_mst_inv_barang_habispakai`)) order by `inv_inventaris_habispakai_opname`.`tgl_opname` desc limit 1),'0') AS `harga_opname`,ifnull((select `inv_inventaris_habispakai_opname_item`.`jml_akhir` from (`inv_inventaris_habispakai_opname` left join `inv_inventaris_habispakai_opname_item` on((`inv_inventaris_habispakai_opname`.`id_inv_inventaris_habispakai_opname` = `inv_inventaris_habispakai_opname_item`.`id_inv_inventaris_habispakai_opname`))) where ((`inv_inventaris_habispakai_opname_item`.`batch` = `inv_inventaris_habispakai_distribusi_item`.`batch`) and (`inv_inventaris_habispakai_opname_item`.`id_mst_inv_barang_habispakai` = `inv_inventaris_habispakai_distribusi_item`.`id_mst_inv_barang_habispakai`)) order by `inv_inventaris_habispakai_opname`.`tgl_opname` desc limit 1),'0') AS `jml_opname`,ifnull((ifnull((select `inv_inventaris_habispakai_opname_item`.`jml_akhir` from (`inv_inventaris_habispakai_opname` left join `inv_inventaris_habispakai_opname_item` on((`inv_inventaris_habispakai_opname`.`id_inv_inventaris_habispakai_opname` = `inv_inventaris_habispakai_opname_item`.`id_inv_inventaris_habispakai_opname`))) where ((`inv_inventaris_habispakai_opname_item`.`batch` = `inv_inventaris_habispakai_distribusi_item`.`batch`) and (`inv_inventaris_habispakai_opname_item`.`id_mst_inv_barang_habispakai` = `inv_inventaris_habispakai_distribusi_item`.`id_mst_inv_barang_habispakai`) and (`inv_inventaris_habispakai_opname`.`tgl_opname` < `func`())) order by `inv_inventaris_habispakai_opname`.`tgl_opname` desc limit 1),0) + ifnull((select sum(`a`.`jml`) from (`inv_inventaris_habispakai_distribusi_item` `a` join `inv_inventaris_habispakai_distribusi` `b` on((`a`.`id_inv_inventaris_habispakai_distribusi` = `b`.`id_inv_inventaris_habispakai_distribusi`))) where ((`a`.`batch` = `inv_inventaris_habispakai_distribusi_item`.`batch`) and (`a`.`id_mst_inv_barang_habispakai` = `inv_inventaris_habispakai_distribusi_item`.`id_mst_inv_barang_habispakai`) and (`b`.`tgl_distribusi` > ifnull((select `c`.`tgl_opname` from (`inv_inventaris_habispakai_opname` `c` left join `inv_inventaris_habispakai_opname_item` `d` on((`c`.`id_inv_inventaris_habispakai_opname` = `d`.`id_inv_inventaris_habispakai_opname`))) where ((`d`.`batch` = `a`.`batch`) and (`d`.`id_mst_inv_barang_habispakai` = `a`.`id_mst_inv_barang_habispakai`) and (`c`.`tgl_opname` < `func`())) order by `c`.`tgl_opname` desc limit 1),'0000-00-00')) and (`b`.`tgl_distribusi` <= `func`()))),0)),0) AS `jmlawal`,if((ifnull((select `inv_inventaris_habispakai_opname`.`tgl_opname` from (`inv_inventaris_habispakai_opname` left join `inv_inventaris_habispakai_opname_item` on((`inv_inventaris_habispakai_opname`.`id_inv_inventaris_habispakai_opname` = `inv_inventaris_habispakai_opname_item`.`id_inv_inventaris_habispakai_opname`))) where ((`inv_inventaris_habispakai_opname_item`.`batch` = `inv_inventaris_habispakai_distribusi_item`.`batch`) and (`inv_inventaris_habispakai_opname_item`.`id_mst_inv_barang_habispakai` = `inv_inventaris_habispakai_distribusi_item`.`id_mst_inv_barang_habispakai`)) order by `inv_inventaris_habispakai_opname`.`tgl_opname` desc limit 1),(curdate() + interval 1 day)) < curdate()),ifnull((select `inv_inventaris_habispakai_opname_item`.`harga` from (`inv_inventaris_habispakai_opname` left join `inv_inventaris_habispakai_opname_item` on((`inv_inventaris_habispakai_opname`.`id_inv_inventaris_habispakai_opname` = `inv_inventaris_habispakai_opname_item`.`id_inv_inventaris_habispakai_opname`))) where ((`inv_inventaris_habispakai_opname_item`.`batch` = `inv_inventaris_habispakai_distribusi_item`.`batch`) and (`inv_inventaris_habispakai_opname_item`.`id_mst_inv_barang_habispakai` = `inv_inventaris_habispakai_distribusi_item`.`id_mst_inv_barang_habispakai`)) order by `inv_inventaris_habispakai_opname`.`tgl_opname` desc limit 1),0),ifnull((select `inv_inventaris_habispakai_pembelian_item`.`harga` from (`inv_inventaris_habispakai_pembelian` left join `inv_inventaris_habispakai_pembelian_item` on((`inv_inventaris_habispakai_pembelian`.`id_inv_hasbispakai_pembelian` = `inv_inventaris_habispakai_pembelian_item`.`id_inv_hasbispakai_pembelian`))) where ((`inv_inventaris_habispakai_pembelian_item`.`batch` = `inv_inventaris_habispakai_distribusi_item`.`batch`) and (`inv_inventaris_habispakai_pembelian_item`.`id_mst_inv_barang_habispakai` = `inv_inventaris_habispakai_distribusi_item`.`id_mst_inv_barang_habispakai`)) order by `inv_inventaris_habispakai_pembelian_item`.`tgl_update` desc limit 1),0)) AS `harga` from ((`inv_inventaris_habispakai_distribusi` left join `inv_inventaris_habispakai_distribusi_item` on((`inv_inventaris_habispakai_distribusi`.`id_inv_inventaris_habispakai_distribusi` = `inv_inventaris_habispakai_distribusi_item`.`id_inv_inventaris_habispakai_distribusi`))) join `mst_inv_barang_habispakai` on((`mst_inv_barang_habispakai`.`id_mst_inv_barang_habispakai` = `inv_inventaris_habispakai_distribusi_item`.`id_mst_inv_barang_habispakai`))) group by `inv_inventaris_habispakai_distribusi_item`.`batch`,`inv_inventaris_habispakai_distribusi_item`.`id_mst_inv_barang_habispakai`;
CREATE  VIEW `bhp_distribusi` AS select `inv_inventaris_habispakai_pembelian_item`.`id_inv_hasbispakai_pembelian` AS `id_inv_hasbispakai_pembelian`,`inv_inventaris_habispakai_pembelian_item`.`id_mst_inv_barang_habispakai` AS `id_mst_inv_barang_habispakai`,`inv_inventaris_habispakai_pembelian_item`.`batch` AS `batch`,`inv_inventaris_habispakai_pembelian_item`.`code_cl_phc` AS `code_cl_phc`,`inv_inventaris_habispakai_pembelian_item`.`harga` AS `harga`,`inv_inventaris_habispakai_pembelian_item`.`tgl_kadaluarsa` AS `tgl_kadaluarsa`,`inv_inventaris_habispakai_pembelian_item`.`tgl_update` AS `tgl_update`,`mst_inv_barang_habispakai`.`uraian` AS `uraian`,`mst_inv_barang_habispakai`.`id_mst_inv_barang_habispakai_jenis` AS `id_mst_inv_barang_habispakai_jenis`,ifnull((select `inv_inventaris_habispakai_distribusi`.`tgl_distribusi` from (`inv_inventaris_habispakai_distribusi` join `inv_inventaris_habispakai_distribusi_item` on((`inv_inventaris_habispakai_distribusi`.`id_inv_inventaris_habispakai_distribusi` = `inv_inventaris_habispakai_distribusi_item`.`id_inv_inventaris_habispakai_distribusi`))) where ((`inv_inventaris_habispakai_distribusi_item`.`id_mst_inv_barang_habispakai` = `inv_inventaris_habispakai_pembelian_item`.`id_mst_inv_barang_habispakai`) and (`inv_inventaris_habispakai_distribusi_item`.`batch` = `inv_inventaris_habispakai_pembelian_item`.`batch`)) order by `inv_inventaris_habispakai_distribusi`.`tgl_distribusi` desc limit 1),'0000-00-00') AS `tgl_distribusi`,((sum(`inv_inventaris_habispakai_pembelian_item`.`jml`) - sum(`inv_inventaris_habispakai_pembelian_item`.`jml_rusak`)) - ifnull((select sum(`inv_inventaris_habispakai_distribusi_item`.`jml`) from `inv_inventaris_habispakai_distribusi_item` where ((`inv_inventaris_habispakai_distribusi_item`.`id_mst_inv_barang_habispakai` = `inv_inventaris_habispakai_pembelian_item`.`id_mst_inv_barang_habispakai`) and (`inv_inventaris_habispakai_distribusi_item`.`batch` = `inv_inventaris_habispakai_pembelian_item`.`batch`))),0)) AS `jumlah` from ((`inv_inventaris_habispakai_pembelian` left join `inv_inventaris_habispakai_pembelian_item` on(((`inv_inventaris_habispakai_pembelian`.`id_inv_hasbispakai_pembelian` = `inv_inventaris_habispakai_pembelian_item`.`id_inv_hasbispakai_pembelian`) and (`inv_inventaris_habispakai_pembelian`.`pilihan_status_pembelian` = '2')))) join `mst_inv_barang_habispakai` on((`mst_inv_barang_habispakai`.`id_mst_inv_barang_habispakai` = `inv_inventaris_habispakai_pembelian_item`.`id_mst_inv_barang_habispakai`))) group by `inv_inventaris_habispakai_pembelian_item`.`id_mst_inv_barang_habispakai`,`inv_inventaris_habispakai_pembelian_item`.`batch` having (`jumlah` > 0);


CREATE FUNCTION bulan() RETURNS VARCHAR(4) 
RETURN @bulan
CREATE  FUNCTION func() RETURNS DATE
RETURN @var
CREATE FUNCTION `tahun`() RETURNS VARCHAR(4) CHARSET latin1
RETURN @tahun
CREATE FUNCTION `tglkondisi`() RETURNS DATE
RETURN @tglkondisi
CREATE  FUNCTION `tglrusak`() RETURNS DATE
RETURN @tglrusak